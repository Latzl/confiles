#!/bin/bash

get_usage() {
    cat <<_USAGE_EOF_
local_info fzf. fzf dirctories spcecified by environment variable LIF_SEARCH_DIRS.
Usage: lif-fzf [find args]
    +h, ++help
        Print this help message and exit.
_USAGE_EOF_
}


if [ -z "$LIF_SEARCH_DIRS" ]; then
    echo "LIF_SEARCH_DIRS is not set" >&2
    exit 1
fi

while [ "$#" -gt 0 ]; do
    case "$1" in
    +h | ++help)
        get_usage
        exit 0
        ;;
    *)
        find_args+=("$1")
        shift
        ;;
    esac
done

search_dirs=()
while IFS= read -r -d ':' line; do
    [[ -n $line ]] && search_dirs+=("$line")
done <<<"${LIF_SEARCH_DIRS}:"

get_select(){
    for dir in "${search_dirs[@]}"; do
        find "$dir" -xdev "${find_args[@]}" -print0
    done | fzf --read0
}

get_select